<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar</title>
    <link rel="stylesheet" href="./reset.css">
    <link rel="stylesheet" href="./app.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
    <header id="header"></header>
    <div class="container">
        <div class="timer"></div>
        <div id="waether"></div>
        <div class="wrap">
            <!-- 캘린더 -->
            <div id="myCalendar" class="myCalendar"></div>
            <!-- TodoList -->
            <div class="wrap_list">
                <div class="listArea">
                    <div id="todoList"></div>
                </div>
            </div>
        </div>
    </div>
    <footer id="footer">
        
    </footer>
    
</body>
<script src="./calendar.js"></script>
<script src="./todoList.js"></script>
<script>
const timerDiv = createDiv('timer');

const updateClock = () =>{
    const date = new Date();
    return date;
}
const setMonth = createDiv('setMonth');
const textClock = (date)=>{
    const second = ('0' + date.getSeconds()).slice(-2); // 2자리수가 되면 문자 3자리가 될수도있으니 염두하고 slice(-2) 해야함
    const minit = ('0' + date.getMinutes()).slice(-2); // 2자리수가 되면 문자 3자리가 될수도있으니 염두하고 slice(-2) 해야함
    const day = ('0' + date.getDate()).slice(-2); // 2자리수가 되면 문자 3자리가 될수도있으니 염두하고 slice(-2) 해야함
    const month = ('0' + (date.getMonth() + 1)).slice(-2);
    
    const clickArea = document.querySelector('.timer');
   
    setMonth.textContent = `${month}월 ${day}일 ${minit}분 ${second}초`;
    clickArea.appendChild(setMonth);
}

textClock(updateClock());

setInterval(()=> {
    const currentDate = updateClock();
    textClock(currentDate);
}, 1000);



// console.log(time);
// console.log(time > 18 ? '밤' : '낮');
const weatherIcon = (key) => {
    switch (key) {
        case 'Clouds':
            return '<img src="img/clouds.png" alt="Clouds">';
        case 'Clear':
            return '<img src="img/Clear.png" alt="Clear">';            
        // 추가적인 날씨에 대한 경우를 계속해서 추가할 수 있습니다.
        // case 'sun':
        //     return '<img src="img/sun.png" alt="Sun">';
        // case 'rain':
        //     return '<img src="img/rain.png" alt="Rain">';
        // ...

        default:
            return ''; // 알 수 없는 날씨에 대한 기본 이미지를 빈 문자열로 반환합니다.
    }
};
    // clear: 1,
    // clouds : 2,
    // drizzle : 3,
    // humidity : 4,
    // mist: 5,
    // rain : 6,
    // search : 7,
    // snow : 8,
    // wind : 9
  
    const apiURI = 'http://api.openweathermap.org/data/2.5/forecast?q=seoul&cnt=21&appid=4ff4e9b9bb000db3b5905140478fd229';
const test = document.getElementById('waether');
const createDiv3 = (what, Name) => {
    const div = document.createElement('div');
    what === 1
        ? div.classList.add(Name)
        : div.setAttribute('id', Name);
    return div;
}

const loadingText = createDiv(1, 'loading');
loadingText.textContent = 'Loading...';
test.appendChild(loadingText);


const fetchData = async () =>{
    
fetch(apiURI)
    .then(response => {
        if (response.ok) {
            return response.json();
        } else {
            throw new Error('ERROR!!!');
        }
    })
    .then(data => {
        const cityName = data.city.name;
        const currentDateTime = new Date();
        const weatherResponse = data.list.filter(entry => {
            // API에서 받아온 시간 문자열을 Date 객체로 변환
            const forecastDateTime = new Date(entry.dt_txt.replace(/-/g, '/'));

            return forecastDateTime.setHours(forecastDateTime.getHours() + 3) > currentDateTime; // 현재 시간 이후의 데이터만 필터링
        });
        const text = createDiv3(1, 'weatherWrap');
        test.removeChild(loadingText);
        test.appendChild(text);

        weatherResponse.map(e => {
            const weatherday = createDiv3(null, 'weatherday')
            let HTML = '';
            HTML += e.dt_txt , '날짜';
            HTML += Math.round(e.main.temp - 273.15), '온도';
            HTML += e.weather[0].main, '메인';
            HTML += e.main.humidity, '습도';
            HTML += e.weather[0].main, '날씨 메인';
            HTML += e.weather[0].description, '하늘 맑은지 보는거';
            HTML += e.weather[0].icon, '딱히 안쓸듯';
            HTML += e.wind.speed, '풍속';
            weatherday.textContent = HTML;
            text.appendChild(weatherday);
        });
    })
    .catch(error => {
        console.error('Error fetching data:', error);
        loadingText.textContent = error;
    });
}

fetchData();
// 여기서는 weatherPromise가 Promise 객체이므로, then()이나 catch()를 사용할 수 있습니다.

</script>
</html> 